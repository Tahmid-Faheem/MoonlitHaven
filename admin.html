<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Moonlit Haven — Admin Panel</title>
<script src="https://cdn.tailwindcss.com"></script>
<script type="module">
  // Firebase SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, where } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
  import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";

  // Firebase config (replace with your Firebase project config)
  const firebaseConfig = {
    apiKey: "AIzaSyD16OCQ3vMjRJMisZTcuYwhhGT36DYhI68",
    authDomain: "moonlit-haven.firebaseapp.com",
    projectId: "moonlit-haven",
    storageBucket: "moonlit-haven.appspot.com",
    messagingSenderId: "42286166550",
    appId: "1:42286166550:web:42260b54e20da374eb7b37"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  // DOM
  window.addEventListener('DOMContentLoaded', () => {
    const loginForm = document.getElementById('loginForm');
    const adminPanel = document.getElementById('adminPanel');
    const messageBox = document.getElementById('messageBox');
    const productForm = document.getElementById('productForm');
    const productList = document.getElementById('productList');

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
        loginForm.style.display = 'none';
        adminPanel.style.display = 'block';
        messageBox.textContent = 'Logged in successfully!';
        loadProducts();
      } catch (err) {
        messageBox.textContent = 'Login failed: ' + err.message;
      }
    });

    // Add product
    productForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('pName').value;
      const desc = document.getElementById('pDesc').value;
      const price = document.getElementById('pPrice').value;
      const img = document.getElementById('pImg').value;
      const page = document.getElementById('pPage').value;

      try {
        await addDoc(collection(db, "products"), {
          name, desc, price, img, page, timestamp: Date.now()
        });
        messageBox.textContent = 'Product added successfully!';
        productForm.reset();
        loadProducts();
      } catch (err) {
        messageBox.textContent = 'Error adding product: ' + err.message;
      }
    });

    // Load products
    async function loadProducts() {
      productList.innerHTML = '';
      const querySnapshot = await getDocs(collection(db, "products"));
      querySnapshot.forEach(docSnap => {
        const data = docSnap.data();
        const li = document.createElement('li');
        li.classList.add('border', 'p-2', 'mb-2', 'flex', 'justify-between', 'items-center');
        li.innerHTML = `
          <div>
            <strong>${data.name}</strong> (${data.page}) - ${data.price}<br>
            <small>${data.desc}</small>
          </div>
          <button class="bg-red-600 text-white px-2 py-1 rounded">Delete</button>
        `;
        const btn = li.querySelector('button');
        btn.addEventListener('click', async () => {
          await deleteDoc(doc(db, "products", docSnap.id));
          loadProducts();
        });
        productList.appendChild(li);
      });
    }
  });
</script>
</head>

<body class="bg-gray-50 p-6">
<h1 class="text-3xl font-bold mb-6 text-center">Moonlit Haven — Admin Panel</h1>

<div id="messageBox" class="text-center text-red-600 mb-4"></div>

<!-- LOGIN FORM -->
<form id="loginForm" class="max-w-sm mx-auto bg-white p-6 rounded shadow-md">
  <h2 class="text-xl font-semibold mb-4">Admin Login</h2>
  <input id="email" type="email" placeholder="Email" class="border p-2 w-full mb-2 rounded" required />
  <input id="password" type="password" placeholder="Password" class="border p-2 w-full mb-4 rounded" required />
  <button type="submit" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">Login</button>
</form>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="hidden max-w-xl mx-auto bg-white p-6 rounded shadow-md">
  <h2 class="text-xl font-semibold mb-4">Add New Product</h2>
  <form id="productForm">
    <input id="pName" placeholder="Product Name" class="border p-2 w-full mb-2 rounded" required />
    <input id="pDesc" placeholder="Description" class="border p-2 w-full mb-2 rounded" required />
    <input id="pPrice" placeholder="Price" class="border p-2 w-full mb-2 rounded" required />
    <input id="pImg" placeholder="Image URL" class="border p-2 w-full mb-2 rounded" required />
    <select id="pPage" class="border p-2 w-full mb-4 rounded" required>
      <option value="index">Home</option>
      <option value="gypsum">Gypsum</option>
      <option value="bangles">Bangles</option>
    </select>
    <button type="submit" class="w-full bg-green-600 text-white p-2 rounded hover:bg-green-700">Add Product</button>
  </form>

  <h2 class="text-xl font-semibold mt-6 mb-2">Current Products</h2>
  <ul id="productList" class="space-y-2"></ul>
</div>
</body>
</html>